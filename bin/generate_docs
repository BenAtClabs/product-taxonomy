#!/usr/bin/env ruby
# frozen_string_literal: true

require "yaml"
require "json"
require "fileutils"

require_relative "../application"

version = "unstable" # eventually bin command
target = "#{Application.root}/docs/_data/#{version}"
FileUtils.mkdir_p(target)

category_data = JSON.load_file("#{Application.root}/dist/categories.json").fetch("verticals")
attribute_data = JSON.load_file("#{Application.root}/dist/attributes.json").fetch("attributes")

File.open("#{target}/sibling_groups.yml", "w") do |file|
  file.write(Docs::SiblingGroupsSerializer.serialize(category_data))
  file.write("\n")
end

File.open("#{target}/search_index.json", "w") do |file|
  file.write(Docs::SearchIndexSerializer.serialize(category_data))
  file.write("\n")
end

File.open("#{target}/attributes.yml", "w") do |file|
  file.write(attribute_data.to_yaml(line_width: 1000))
  file.write("\n")
end
